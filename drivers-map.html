<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LogiSync Driver Navigation</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom Config & Styles -->
    <style>
    /*role based glow system */
    :root {
  --glow-color-1: rgba(66,133,244,0.6);
  --glow-color-2: rgba(66,133,244,0.4);
  --glow-color-3: rgba(66,133,244,0.2);
}
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }


.leaflet-marker-icon {
  overflow: visible !important;
}

.vehicle-icon {
  position: relative;
}

.vehicle-icon::after {
  content: "";
  position: absolute;
  inset: -46px;
  border-radius: 50%;
  background: radial-gradient(
    circle,
    var(--glow-color-1) 0%,
    var(--glow-color-2) 35%,
    var(--glow-color-3) 60%,
    transparent 35%
  );
  animation: pulse-ring 1.8s infinite;
  z-index: 0;
  pointer-events: none;
}
        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Map fills screen */
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 0;
            background-color: #242f3e; /* Fallback color */
        }

        /* Pulse animation for user location */
        @keyframes pulse-ring {
            0% { transform: scale(0.33); opacity: 1; }
            80%, 100% { opacity: 0; }
        }
        @keyframes pulse-dot {
            0% { transform: scale(0.8); }
            50% { transform: scale(1); }
            100% { transform: scale(0.8); }
        }
        .driver-marker-ring {
            position: absolute;
            height: 50px;
            width: 50px;
            border-radius: 50%;
            background-color: rgba(66, 133, 244, 0.4);
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
            top: -15px;
            left: -15px;
        }
        .driver-marker-core {
            position: relative;
            background-color: #4285F4;
            border: 3px solid white;
            border-radius: 50%;
            height: 20px;
            width: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 2;
        }
        .driver-marker-arrow {
            position: absolute;
            top: -18px; /* Position in front */
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-bottom: 24px solid rgba(66, 133, 244, 0.3); /* Cone of vision */
            z-index: 1;
        }

        /* Glassmorphism utility */
        .glass-dark {
            background: rgba(32, 33, 36, 0.95);
            backdrop-filter: blur(8px);
        }

        /* Transition utilities for smooth sheet animation */
        .sheet-transition {
            transition-property: max-height, opacity, padding;
            transition-duration: 300ms;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
        .leaflet-marker-icon {
  overflow: visible !important;
}

    </style>
</head>
<body class="bg-gray-900 overflow-hidden text-white font-sans antialiased h-screen w-screen relative">

    <!-- MAP CONTAINER -->
    <div id="map"></div>

    <!-- UI LAYER (Pointer events none allows clicking through empty spaces to map) -->
    <div class="absolute inset-0 z-10 flex flex-col justify-between pointer-events-none">
        
        <!-- TOP SECTION: Navigation Instructions -->
        <div class="pt-4 px-4 w-full max-w-lg mx-auto pointer-events-auto">
            <!-- Green Instruction Card -->
            <div class="bg-[#0F9D58] rounded-2xl shadow-xl flex flex-col overflow-hidden">
                <!-- Main Instruction -->
                <div class="p-4 flex items-start gap-4">
                    <div class="mt-1">
                        <i class="fa-solid fa-arrow-up text-4xl text-white"></i>
                    </div>
                    <div class="flex-1">
                        <h2 class="text-3xl font-bold leading-none">200 m</h2>
                        <p class="text-xl font-medium text-green-100 truncate mt-1">Head South on Market St</p>
                    </div>
                </div>
            </div>

            <!-- Secondary Instruction (Then...) -->
            <div class="bg-[#0B8043] mx-2 px-4 py-2 rounded-b-xl shadow-lg flex items-center gap-3 -mt-1 relative z-[-1]">
                <span class="text-green-100 font-medium">Then</span>
                <i class="fa-solid fa-arrow-left text-white text-sm"></i>
                <span class="text-green-100 font-medium truncate">Turn left onto 4th Ave</span>
            </div>
        </div>

        <!-- RIGHT SIDE: Floating Controls -->
        <div class="absolute top-48 right-4 flex flex-col gap-3 pointer-events-auto">
            <!-- Compass -->
            <button onclick="resetView()" class="w-12 h-12 rounded-full bg-gray-800 text-white shadow-lg flex items-center justify-center active:scale-95 transition-transform border border-gray-700 group">
                <i id="compass-icon" class="fa-regular fa-compass text-lg text-red-500 transition-transform duration-700"></i>
            </button>
            <!-- Search -->
            <button onclick="activateSearch()" class="w-12 h-12 rounded-full bg-gray-800 text-white shadow-lg flex items-center justify-center active:scale-95 transition-transform border border-gray-700">
                <i class="fa-solid fa-magnifying-glass text-lg"></i>
            </button>
            <!-- Audio Toggle -->
            <button onclick="toggleAudio()" class="w-12 h-12 rounded-full bg-gray-800 text-white shadow-lg flex items-center justify-center active:scale-95 transition-transform border border-gray-700">
                <i id="audio-icon" class="fa-solid fa-volume-high text-lg"></i>
            </button>
        </div>

        <!-- BOTTOM SECTION: Stats & Menu -->
        <div class="w-full pointer-events-auto mt-auto">
            <!-- Floating Recenter Button (Appears above sheet) -->
            <div class="flex justify-end px-4 mb-4">
                <button onclick="resetView()" class="w-14 h-14 rounded-full bg-white text-blue-600 shadow-xl flex items-center justify-center active:scale-95 transition-transform">
                    <span class="sr-only">Recenter</span>
                    <i class="fa-solid fa-location-crosshairs text-2xl"></i>
                </button>
            </div>

            <!-- Bottom Sheet -->
            <div id="bottom-sheet" class="glass-dark rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.5)] border-t border-gray-700 pb-safe">
                
                <!-- HEADER & HANDLE (Click to Toggle) -->
                <div onclick="toggleSheet()" class="cursor-pointer active:bg-gray-800/30 transition-colors rounded-t-3xl pb-2">
                    <!-- Handle -->
                    <div class="w-full flex justify-center pt-3 pb-1 relative">
                        <div class="w-12 h-1.5 bg-gray-600 rounded-full"></div>
                        <!-- Toggle Chevron Indicator -->
                        <i id="sheet-chevron" class="fa-solid fa-chevron-down absolute right-6 text-gray-500 transition-transform duration-300"></i>
                    </div>

                    <!-- Primary Info Row -->
                    <div class="px-5 py-2 flex items-center justify-between">
                        <div class="flex flex-col">
                            <div class="flex items-baseline gap-2">
                                <span class="text-3xl font-bold text-[#34A853]">10 min</span>
                                <span class="text-lg text-gray-400 font-medium">(2.4 km)</span>
                            </div>
                            <div class="text-gray-300 font-medium">10:42 AM ETA</div>
                        </div>
                        
                        <div class="flex items-center gap-3">
                            <button onclick="event.stopPropagation()" class="w-10 h-10 rounded-full bg-gray-700 hover:bg-gray-600 flex items-center justify-center transition-colors">
                                <i class="fa-solid fa-xmark text-white text-lg"></i>
                            </button>
                            <button onclick="event.stopPropagation()" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-full flex items-center gap-2 transition-colors">
                                <i class="fa-solid fa-list-ul text-sm"></i>
                                <span class="font-medium">Steps</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Divider (Only visible when expanded) -->
                <div id="sheet-divider" class="border-b border-gray-700/50 mx-4 sheet-transition opacity-100"></div>

                <!-- Menu Items (Scrollable & Collapsible) -->
                <div id="sheet-content" class="overflow-hidden sheet-transition max-h-[40vh] opacity-100">
                    <div class="overflow-y-auto max-h-[40vh] no-scrollbar px-2 py-2">
                        <!-- Action Grid -->
                        <div class="grid grid-cols-4 gap-2 mb-4 px-2 pt-2">
                            <div class="flex flex-col items-center gap-1 cursor-pointer active:opacity-70">
                                <div class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center shadow-lg">
                                    <i class="fa-solid fa-plus text-white text-xl"></i>
                                </div>
                                <span class="text-xs text-gray-400">Report</span>
                            </div>
                            <div class="flex flex-col items-center gap-1 cursor-pointer active:opacity-70">
                                <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center shadow-lg">
                                    <i class="fa-solid fa-share-nodes text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-gray-400">Share</span>
                            </div>
                            <div class="flex flex-col items-center gap-1 cursor-pointer active:opacity-70">
                                <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center shadow-lg">
                                    <i class="fa-solid fa-magnifying-glass-location text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-gray-400">Search</span>
                            </div>
                            <div class="flex flex-col items-center gap-1 cursor-pointer active:opacity-70">
                                <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center shadow-lg">
                                    <i class="fa-solid fa-gear text-white text-lg"></i>
                                </div>
                                <span class="text-xs text-gray-400">Settings</span>
                            </div>
                        </div>

                        <!-- Theme Toggles -->
                        <div class="bg-gray-800/50 rounded-xl mx-2 p-3 mb-2">
                            <h4 class="text-xs font-bold text-gray-500 uppercase mb-2 ml-1">Map Layer</h4>
                            <div class="flex gap-2">
                                <button onclick="setLayer('dark')" class="flex-1 py-2 bg-gray-700 rounded-lg text-sm font-medium hover:bg-gray-600 active:bg-gray-500 transition-colors border border-blue-500/50">Dark</button>
                                <button onclick="setLayer('light')" class="flex-1 py-2 bg-gray-700 rounded-lg text-sm font-medium hover:bg-gray-600 active:bg-gray-500 transition-colors">Light</button>
                                <button onclick="setLayer('satellite')" class="flex-1 py-2 bg-gray-700 rounded-lg text-sm font-medium hover:bg-gray-600 active:bg-gray-500 transition-colors">Sat</button>
                            </div>
                        </div>

                        <!-- List Options -->
                        <div class="flex flex-col space-y-1 pb-4">
                            <button class="flex items-center gap-4 p-4 hover:bg-gray-800 rounded-xl transition-colors mx-2 text-left">
                                <i class="fa-solid fa-gas-pump text-gray-400 w-6 text-center"></i>
                                <div class="flex-1 border-b border-gray-700 pb-4 mb-[-16px]">
                                    <span class="font-medium text-lg">Nearby Fuel</span>
                                </div>
                            </button>
                            <button class="flex items-center gap-4 p-4 hover:bg-gray-800 rounded-xl transition-colors mx-2 text-left">
                                <i class="fa-solid fa-wrench text-gray-400 w-6 text-center"></i>
                                <div class="flex-1 border-b border-gray-700 pb-4 mb-[-16px]">
                                    <span class="font-medium text-lg">Garage</span>
                                </div>
                            </button>
                            <button class="flex items-center gap-4 p-4 hover:bg-red-900/30 rounded-xl transition-colors mx-2 text-left group">
                                <i class="fa-solid fa-triangle-exclamation text-red-500 w-6 text-center group-hover:animate-pulse"></i>
                                <div class="flex-1">
                                    <span class="font-bold text-lg text-red-500">SOS</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const socket = io("http://localhost:5000");

socket.on("connect", () => {
  console.log("ðŸŸ¢ Driver connected:", socket.id);
});
        // --- Configuration ---
        const DEFAULT_COORDS = [40.7128, -74.0060]; // New York City Demo
        const DEST_COORDS = [40.7200, -74.0100];
        
const vehicleType = "truck"; 

// options: "truck", "bike", "car", "ev"
let navigationMode = true;
let lastPosition = null;
        
        // --- Map Initialization ---
        const map = L.map('map', {
            zoomControl: false, // Hide default zoom controls
            attributionControl: false // Minimalist look
        }).setView(DEFAULT_COORDS, 17);

        // --- Tile Layers ---
        const layers = {
            dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 20,
                subdomains: 'abcd'
            }),
            light: L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                maxZoom: 20,
                subdomains: 'abcd'
            }),
            satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                maxZoom: 19
            })
        };
    function applyVehicleGlow(type) {
  const root = document.documentElement;

  if (type === "bike") {
    root.style.setProperty("--glow-color-1", "rgba(66,133,244,0.6)");
    root.style.setProperty("--glow-color-2", "rgba(66,133,244,0.4)");
    root.style.setProperty("--glow-color-3", "rgba(66,133,244,0.2)");
  }
  else if (type === "truck") {
    root.style.setProperty("--glow-color-1", "rgba(245,158,11,0.6)");
    root.style.setProperty("--glow-color-2", "rgba(245,158,11,0.4)");
    root.style.setProperty("--glow-color-3", "rgba(245,158,11,0.2)");
  }
  else if (type === "car") {
    root.style.setProperty("--glow-color-1", "rgba(250,204,21,0.6)");
    root.style.setProperty("--glow-color-2", "rgba(250,204,21,0.4)");
    root.style.setProperty("--glow-color-3", "rgba(250,204,21,0.2)");
  }
  else if (type === "ev") {
    root.style.setProperty("--glow-color-1", "rgba(34,197,94,0.7)");
    root.style.setProperty("--glow-color-2", "rgba(34,197,94,0.45)");
    root.style.setProperty("--glow-color-3", "rgba(34,197,94,0.25)");
  }
  else if (type === "emergency") {
    root.style.setProperty("--glow-color-1", "rgba(239,68,68,0.7)");
    root.style.setProperty("--glow-color-2", "rgba(239,68,68,0.45)");
    root.style.setProperty("--glow-color-3", "rgba(239,68,68,0.25)");
  }
}
applyVehicleGlow(vehicleType);

       

        // Add default layer
        let currentLayer = layers.dark;
        currentLayer.addTo(map);
        // ==============================
// VEHICLE ICON FACTORY
// ==============================
function getVehicleIcon(type) {
  let iconClass = "fa-truck";
  let bgColor = "#2563eb"; // blue

  if (type === "bike") {
    iconClass = "fa-motorcycle";
    bgColor = "#16a34a";
  } else if (type === "car") {
    iconClass = "fa-car";
    bgColor = "#f59e0b";
  } else if (type === "ev") {
    iconClass = "fa-bolt";
    bgColor = "#22c55e";
  }

  return L.divIcon({
    className: "",
    html: `
      <div class="vehicle-icon" style="
       width:40px;
     height:40px;
     border-radius:50%;
     background:${bgColor};
     display:flex;
     align-items:center;
     justify-content:center;
     box-shadow:0 0 14px rgba(0,0,0,0.6);
     border:3px solid white;
     transition: transform 0.25s linear;
     ">
        <i class="fa-solid ${iconClass}" style="color:white;font-size:18px;"></i>
      </div>
    `,
    iconSize: [40, 40],
    iconAnchor: [20, 20]
  });
}
function calculateBearing(start, end) {
  const toRad = (deg) => deg * Math.PI / 180;
  const toDeg = (rad) => rad * 180 / Math.PI;

  const lat1 = toRad(start[0]);
  const lon1 = toRad(start[1]);
  const lat2 = toRad(end[0]);
  const lon2 = toRad(end[1]);

  const dLon = lon2 - lon1;

  const y = Math.sin(dLon) * Math.cos(lat2);
  const x =
    Math.cos(lat1) * Math.sin(lat2) -
    Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);

  let bearing = toDeg(Math.atan2(y, x));
  return (bearing + 360) % 360;
}
// Disable auto-follow when user interacts with map
map.on("dragstart zoomstart", () => {
  navigationMode = false;
});
        // --- Custom Markers ---
        
        // 1. Driver Marker (Blue Dot with Pulse)
        const driverIcon = getVehicleIcon(vehicleType);

        const driverMarker = L.marker(DEFAULT_COORDS, { icon: driverIcon }).addTo(map);

       
 
let routePath = [DEFAULT_COORDS];
let liveRoute = L.polyline(routePath, {
  color: "#4285F4",
  weight: 6,
  opacity: 0.9,
  lineJoin: "round",
  lineCap: "round"
}).addTo(map);

       

        // 3. Destination Marker
        const destIcon = L.divIcon({
            html: '<i class="fa-solid fa-location-dot text-red-500 text-3xl drop-shadow-md"></i>',
            className: 'bg-transparent',
            iconSize: [30, 42],
            iconAnchor: [15, 42]
        });
        L.marker(DEST_COORDS, {icon: destIcon}).addTo(map);


        // --- Functions ---

        // Layer Switcher Logic
       function setLayer(type) {
  if (currentLayer) {
    map.removeLayer(currentLayer);
  }
  currentLayer = layers[type];
  currentLayer.addTo(map);

            
            // Adjust UI text colors if light mode
            const texts = document.querySelectorAll('.text-white, .text-gray-300, .text-gray-400');
        }

        // Recenter Map (Bottom Button) & Compass Logic
        function resetView() {
  navigationMode = true;

  map.setView(driverMarker.getLatLng(), 17, {
    animate: true,
    duration: 0.8
  });

  // Animate Compass Icon
  const icon = document.getElementById('compass-icon');
  icon.style.transform = 'rotate(-360deg)';
  setTimeout(() => {
    icon.style.transform = 'rotate(0deg)';
  }, 700);
}

      

        // Search Logic
        function activateSearch() {
            if (!isSheetExpanded) {
                toggleSheet();
            }
            // Visual cue: Flash the search grid item inside the sheet
            const searchIcon = document.querySelector('.fa-magnifying-glass-location');
            if(searchIcon) {
                const searchBtn = searchIcon.parentElement;
                searchBtn.classList.add('ring-4', 'ring-blue-500', 'ring-opacity-50');
                setTimeout(() => searchBtn.classList.remove('ring-4', 'ring-blue-500', 'ring-opacity-50'), 600);
            }
        }

        // Audio Logic
        let audioState = 0; // 0: High, 1: Low, 2: Mute
        const audioIcon = document.getElementById('audio-icon');

        function toggleAudio() {
            audioState = (audioState + 1) % 3;
            
            // Reset base classes
            audioIcon.className = 'fa-solid text-lg transition-all duration-200';
            
            let message = "";

            if (audioState === 0) {
                audioIcon.classList.add('fa-volume-high');
                message = "Audio: On";
            } else if (audioState === 1) {
                audioIcon.classList.add('fa-volume-low');
                message = "Audio: Low";
            } else {
                audioIcon.classList.add('fa-volume-xmark', 'text-gray-400');
                message = "Audio: Muted";
            }

            showToast(message);
        }

        // Helper: Simple Toast Notification
        function showToast(msg) {
            // Remove existing toast if any
            const existing = document.getElementById('nav-toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.id = 'nav-toast';
            toast.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-800/90 text-white px-6 py-3 rounded-full shadow-2xl z-50 transition-all duration-300 backdrop-blur-sm font-medium border border-gray-600';
            toast.textContent = msg;
            document.body.appendChild(toast);
            
            // Fade in
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translate(-50%, -50%) scale(1)';
            });
            
            // Remove after delay
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, -40%) scale(0.9)';
                setTimeout(() => toast.remove(), 300);
            }, 1500);
        }

        // --- Sheet Logic ---
        let isSheetExpanded = true;
        const sheetContent = document.getElementById('sheet-content');
        const sheetDivider = document.getElementById('sheet-divider');
        const sheetChevron = document.getElementById('sheet-chevron');

        function toggleSheet() {
            isSheetExpanded = !isSheetExpanded;
            
            if (isSheetExpanded) {
                // Expand
                sheetContent.style.maxHeight = '40vh';
                sheetContent.style.opacity = '1';
                sheetDivider.style.opacity = '1';
                sheetChevron.style.transform = 'rotate(0deg)';
            } else {
                // Collapse
                sheetContent.style.maxHeight = '0px';
                sheetContent.style.opacity = '0';
                sheetDivider.style.opacity = '0';
                sheetChevron.style.transform = 'rotate(180deg)';
            }
        }


if ("geolocation" in navigator) {
  navigator.geolocation.watchPosition(
    (position) => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const newLatLng = [lat, lng];
   socket.emit("driver:location", {
  driverId: "DRIVER-003",
  lat,
  lng,
  speed: position.coords.speed ? Math.round(position.coords.speed * 3.6) : 40,
  vehicleType: "truck"
});

      // Move vehicle marker
      driverMarker.setLatLng(newLatLng);
      

      // Add point to live route
      routePath.push(newLatLng);
if (routePath.length > 150) routePath.shift();
liveRoute.setLatLngs(routePath);
      // Rotate vehicle based on movement direction
if (lastPosition) {
  const latDiff = newLatLng[0] - lastPosition[0];
  const lngDiff = newLatLng[1] - lastPosition[1];
  const distance = Math.sqrt(latDiff * latDiff + lngDiff * lngDiff);

  // Ignore GPS jitter & phone rotation
  if (distance > 0.00002) {
    const bearing = calculateBearing(lastPosition, newLatLng);

    const markerEl = driverMarker.getElement();
    if (markerEl) {
      const icon = markerEl.querySelector(".vehicle-icon");
      if (icon) {
        icon.style.transform = `rotate(${bearing}deg)`;
      }
    }
  }
}

lastPosition = newLatLng;

      // Center only once
      if (navigationMode) {
  map.setView(newLatLng, map.getZoom(), {
    animate: true,
    duration: 0.5
  });
}
    },
    (error) => {
  console.warn("GPS error â€” fallback mode", error);

  // Simulated movement fallback
  const fakeLatLng = [
    driverMarker.getLatLng().lat + 0.00005,
    driverMarker.getLatLng().lng + 0.00005
  ];

  socket.emit("driver:location", {
    driverId: "DRIVER-001",
    lat: fakeLatLng[0],
    lng: fakeLatLng[1],
    speed: 35,
    vehicleType: "truck"
  });

  driverMarker.setLatLng(fakeLatLng);
  routePath.push(fakeLatLng);
  if (routePath.length > 150) routePath.shift();
  liveRoute.setLatLngs(routePath);

  showToast("GPS weak â€” simulated tracking");
},
    {
      enableHighAccuracy: true,
      maximumAge: 2000,
      timeout: 15000
    }
  );
} else {
  showToast("Geolocation not supported");
}
        map.panBy([0, 100], {animate: false}); 

    </script>
</body>
</html>